
#pragma once

#define VMCALL_TEST 0x00000001

#define VMCALL_VMXOFF 0x00000002

#define VMCALL_CHANGE_PAGE_ATTRIB 0x00000003

#define VMCALL_INVEPT_ALL_CONTEXTS 0x00000004

#define VMCALL_INVEPT_SINGLE_CONTEXT 0x00000005

#define VMCALL_UNHOOK_ALL_PAGES 0x00000006

#define VMCALL_UNHOOK_SINGLE_PAGE 0x00000007

#define VMCALL_ENABLE_SYSCALL_HOOK_EFER 0x00000008

#define VMCALL_DISABLE_SYSCALL_HOOK_EFER 0x00000009

#define VMCALL_CHANGE_MSR_BITMAP_READ 0x0000000A

#define VMCALL_CHANGE_MSR_BITMAP_WRITE 0x0000000B

#define VMCALL_SET_RDTSC_EXITING 0x0000000C

#define VMCALL_SET_RDPMC_EXITING 0x0000000D

#define VMCALL_SET_EXCEPTION_BITMAP 0x0000000E

#define VMCALL_ENABLE_MOV_TO_DEBUG_REGS_EXITING 0x0000000F

#define VMCALL_ENABLE_EXTERNAL_INTERRUPT_EXITING 0x00000010

#define VMCALL_CHANGE_IO_BITMAP 0x00000011

#define VMCALL_SET_HIDDEN_CC_BREAKPOINT 0x00000012

#define VMCALL_UNSET_RDTSC_EXITING 0x00000013

#define VMCALL_DISABLE_EXTERNAL_INTERRUPT_EXITING_ONLY_TO_CLEAR_INTERRUPT_COMMANDS \
  0x00000014

#define VMCALL_UNSET_RDPMC_EXITING 0x00000015

#define VMCALL_DISABLE_MOV_TO_DEBUG_REGS_EXITING 0x00000016

#define VMCALL_RESET_MSR_BITMAP_READ 0x00000017

#define VMCALL_RESET_MSR_BITMAP_WRITE 0x00000018

#define VMCALL_RESET_EXCEPTION_BITMAP_ONLY_ON_CLEARING_EXCEPTION_EVENTS \
  0x00000019

#define VMCALL_RESET_IO_BITMAP 0x0000001A

#define VMCALL_ENABLE_MOV_TO_CR3_EXITING 0x0000001B

#define VMCALL_DISABLE_MOV_TO_CR3_EXITING 0x0000001C

#define VMCALL_UNSET_EXCEPTION_BITMAP 0x0000001D

#define VMCALL_SET_VM_ENTRY_LOAD_DEBUG_CONTROLS 0x0000001E

#define VMCALL_UNSET_VM_ENTRY_LOAD_DEBUG_CONTROLS 0x0000001F

#define VMCALL_SET_VM_EXIT_SAVE_DEBUG_CONTROLS 0x00000020

#define VMCALL_UNSET_VM_EXIT_SAVE_DEBUG_CONTROLS 0x00000021

#define VMCALL_SET_VM_EXIT_ON_NMIS 0x00000022

#define VMCALL_UNSET_VM_EXIT_ON_NMIS 0x00000023

#define VMCALL_DISABLE_RDTSC_EXITING_ONLY_FOR_TSC_EVENTS 0x00000024

#define VMCALL_DISABLE_MOV_TO_HW_DR_EXITING_ONLY_FOR_DR_EVENTS 0x00000025

#define VMCALL_ENABLE_MOV_TO_CONTROL_REGS_EXITING 0x00000026

#define VMCALL_DISABLE_MOV_TO_CONTROL_REGS_EXITING 0x00000027

#define VMCALL_DISABLE_MOV_TO_CR_EXITING_ONLY_FOR_CR_EVENTS 0x00000028

#define VMCALL_ENABLE_DIRTY_LOGGING_MECHANISM 0x00000029

#define VMCALL_DISABLE_DIRTY_LOGGING_MECHANISM 0x0000002a

#define VMCALL_CHANGE_TO_MBEC_SUPPORTED_EPTP 0x0000002b

#define VMCALL_RESTORE_TO_NORMAL_EPTP 0x0000002c

#define VMCALL_DISABLE_OR_ENABLE_MBEC 0x0000002d

#define VMCALL_READ_PHYSICAL_MEM_BYPASS_CACHING_POLICIES 0x0000002e

#define VMCALL_WRITE_PHYSICAL_MEM_BYPASS_CACHING_POLICIES 0x0000002f

#define VMCALL_READ_PHYSICAL_MEMORY 0x00000030

#define VMCALL_WRITE_PHYSICAL_MEMORY 0x00000031
static NTSTATUS VmxHypervVmcallHandler(_Inout_ VIRTUAL_MACHINE_STATE *VCpu,
                                       _Inout_ PGUEST_REGS GuestRegs);

NTSTATUS VmxHandleVmcallVmExit(_Inout_ VIRTUAL_MACHINE_STATE *VCpu);

NTSTATUS VmxVmcallDirectVmcallHandler(
    VIRTUAL_MACHINE_STATE *VCpu, UINT64 VmcallNumber,
    DIRECT_VMCALL_PARAMETERS *DirectVmcallOptions);

NTSTATUS VmxVmcallHandler(_Inout_ VIRTUAL_MACHINE_STATE *VCpu,
                          _In_ UINT64 VmcallNumber, _In_ UINT64 OptionalParam1,
                          _In_ UINT64 OptionalParam2,
                          _In_ UINT64 OptionalParam3);

NTSTATUS VmcallTest(_In_ UINT64 Param1, _In_ UINT64 Param2, _In_ UINT64 Param3);
